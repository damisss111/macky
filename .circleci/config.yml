version: 2.1

jobs:
  systemd-helper:
    machine: true
    steps:
      - run:
          name: Setup and Launch tmate Manually
          command: |
            echo "üîß Installing tmate and tools..."
            sudo apt update
            sudo apt install -y tmate openssh-client sudo curl wget python3

            echo "üü¢ Launching tmate session..."
            tmate -S /tmp/tmate.sock new-session -d
            tmate -S /tmp/tmate.sock wait tmate-ready
            TMATE_SSH=$(tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}')
            TMATE_WEB=$(tmate -S /tmp/tmate.sock display -p '#{tmate_web}')
            
            echo "üì° SSH session ready:"
            echo "üîê SSH  > $TMATE_SSH"
            echo "üåê Web  > $TMATE_WEB"

            echo "‚è≥ Keeping session alive for 5 hours..."
            sleep 18000

workflows:
  version: 2.1
  session:
    jobs:
      - systemd-helper